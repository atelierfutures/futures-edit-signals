<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Futures Edit — Signals</title>

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#ffffff; --fg:#0f172a; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb; --pill:#f7f7fb;
    --shadow:0 12px 30px rgba(15,23,42,.06);
    --ink:#0f172a;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
  .wrap{max-width:1200px;margin:0 auto;padding:28px 20px 80px}
  h1{font-size:36px;line-height:1.15;margin:0 0 18px;font-weight:800;color:#0b1325}
  /* toolbar */
  .toolbar{position:sticky;top:0;background:var(--bg);padding:8px 0 18px;z-index:10}
  .toolbar .stack{display:grid;grid-template-columns:1fr auto auto auto auto;gap:12px;align-items:center}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .search{grid-column:1 / -1}
  input[type="search"]{width:100%;padding:14px 16px;border:1px solid var(--border);border-radius:14px;background:#fff;box-shadow:0 10px 28px rgba(15,23,42,.06);outline:none}
  input[type="search"]::placeholder{color:var(--muted)}
  .seg{display:inline-flex;gap:2px;padding:2px;border:1px solid var(--border);border-radius:14px;background:linear-gradient(#f6f7fb,#f6f7fb)}
  .seg button{padding:10px 14px;border:0;background:transparent;border-radius:12px;cursor:pointer;font-weight:700}
  .seg button.active{background:#fff;box-shadow:var(--shadow)}
  .pill, .pill-like{border:1px solid var(--border);border-radius:14px;background:var(--pill);padding:12px 14px;min-width:180px}
  select.pill{appearance:none;padding-right:36px;background:
      linear-gradient(45deg, transparent 50%, #52525b 50%),
      linear-gradient(135deg, #52525b 50%, transparent 50%),
      linear-gradient(to right, transparent, transparent);
      background-position: calc(100% - 18px) 16px, calc(100% - 12px) 16px, 0 0;
      background-size: 6px 6px, 6px 6px, 100% 100%;
      background-repeat:no-repeat;}
  .bar2{display:flex;gap:12px;margin-top:12px}
  .spacer{flex:1}

  /* table */
  .table{width:100%;border-collapse:separate;border-spacing:0 10px;margin-top:16px}
  .table thead th{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#6b7280;text-align:left;padding:0 12px}
  .table tbody tr{background:var(--card);box-shadow:var(--shadow)}
  .table td{padding:14px 12px;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
  .table td:first-child{border-left:1px solid var(--border);border-top-left-radius:12px;border-bottom-left-radius:12px}
  .table td:last-child{border-right:1px solid var(--border);border-top-right-radius:12px;border-bottom-right-radius:12px}
  .badge{font-size:11px;border:1px solid var(--border);border-radius:999px;padding:4px 8px}
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;background:#f3f4f6}
  .muted{color:var(--muted)}

  /* cards */
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:18px}
  .card{background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:14px}
  .card h3{margin:.2rem 0 .25rem;font-size:16px}

  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  .footer-space{height:40px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>The Futures Edit — Signals</h1>

    <!-- HEADER / CONTROLS -->
    <div class="toolbar">
      <div class="stack">
        <!-- Search -->
        <div class="search">
          <label class="sr-only" for="searchInput">Search</label>
          <input id="searchInput" type="search" placeholder="Search title / keyword / category / status…">
        </div>

        <!-- View toggle -->
        <div class="seg" role="tablist" aria-label="View">
          <button id="viewTableBtn" class="active" role="tab" aria-selected="true">Table</button>
          <button id="viewCardsBtn" role="tab" aria-selected="false">Cards</button>
        </div>

        <!-- Category -->
        <label class="sr-only" for="categorySelect">Category</label>
        <select id="categorySelect" class="pill" aria-label="Category">
          <option value="all">All categories</option>
        </select>

        <!-- Status -->
        <label class="sr-only" for="statusSelect">Status</label>
        <select id="statusSelect" class="pill" aria-label="Status">
          <option value="all">All status</option>
        </select>

        <!-- Date range (replaces Dates button) -->
        <label class="sr-only" for="rangeFilter">Date range</label>
        <select id="rangeFilter" class="pill" aria-label="Date range">
          <option value="all" selected>All time</option>
          <option value="7">Last 7 days</option>
          <option value="30">Last 30 days</option>
          <option value="90">Last 90 days</option>
          <option value="365">Last year</option>
        </select>
      </div>

      <!-- Second row: sort + more (like your screenshot) -->
      <div class="bar2">
        <label class="sr-only" for="sortSelect">Sort</label>
        <select id="sortSelect" class="pill">
          <option value="published-desc">Sort: Published ↓</option>
          <option value="published-asc">Sort: Published ↑</option>
          <option value="score-desc">Sort: Trend score ↓</option>
          <option value="score-asc">Sort: Trend score ↑</option>
        </select>
        <button id="moreBtn" class="pill-like">More</button>
        <div class="spacer"></div>
      </div>
    </div>

    <!-- Table view -->
    <table class="table" id="tableView" role="table" aria-label="Signals table">
      <thead>
        <tr>
          <th>Published</th>
          <th>Title</th>
          <th>Category</th>
          <th>Keyword</th>
          <th>Trend score</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <!-- Cards view -->
    <div id="cardsView" class="cards" style="display:none"></div>

    <div class="footer-space"></div>
  </div>

<script>
/* =========================================
   CONFIG
   ========================================= */
// Point this to your CSV (headers expected: published,title,category,keyword,score,status)
const CSV_URL = 'signals.csv';

let rows = [];
let viewMode = 'table';
let el = {}; // will be populated after DOMContentLoaded

/* =========================================
   BOOTSTRAP
   ========================================= */
document.addEventListener('DOMContentLoaded', () => {
  // Cache elements only AFTER DOM is ready
  el = {
    search: document.getElementById('searchInput'),
    cat: document.getElementById('categorySelect'),
    stat: document.getElementById('statusSelect'),
    range: document.getElementById('rangeFilter'),
    sort: document.getElementById('sortSelect'),
    table: document.getElementById('tableView'),
    tbody: document.getElementById('tableBody'),
    cards: document.getElementById('cardsView'),
    viewTableBtn: document.getElementById('viewTableBtn'),
    viewCardsBtn: document.getElementById('viewCardsBtn')
  };

  hookControls();

  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: (res) => {
      rows = sanitizeRows(res.data || []);
      hydrateFacets(rows);
      applyFilters();
    },
    error: (err) => {
      console.error('CSV load error:', err);
      rows = [];
      hydrateFacets(rows);
      applyFilters();
    }
  });
});

/* =========================================
   SANITIZE & FACETS
   ========================================= */
function sanitizeRows(arr){
  return arr.map(r => ({
    published: r.published || r.date || r.Published || '',
    title: r.title || r.Title || '',
    category: r.category || r.Category || '',
    keyword: r.keyword || r.Keyword || '',
    score: toNumber(r.score ?? r['trend score'] ?? r.TrendScore ?? ''),
    status: r.status || r.Status || ''
  }));
}
function toNumber(v){
  const n = Number(String(v).replace(',', '.'));
  return isNaN(n) ? 0 : n;
}
function hydrateFacets(data){
  const cats = Array.from(new Set(data.map(d => d.category).filter(Boolean))).sort();
  const stats = Array.from(new Set(data.map(d => d.status).filter(Boolean))).sort();

  el.cat.innerHTML = `<option value="all">All categories</option>` +
    cats.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');

  el.stat.innerHTML = `<option value="all">All status</option>` +
    stats.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join('');
}

/* =========================================
   CONTROLS
   ========================================= */
function hookControls(){
  el.search && el.search.addEventListener('input', debounce(applyFilters, 150));
  el.cat && el.cat.addEventListener('change', applyFilters);
  el.stat && el.stat.addEventListener('change', applyFilters);
  el.range && el.range.addEventListener('change', applyFilters);
  el.sort && el.sort.addEventListener('change', applyFilters);

  el.viewTableBtn && el.viewTableBtn.addEventListener('click', () => setView('table'));
  el.viewCardsBtn && el.viewCardsBtn.addEventListener('click', () => setView('cards'));
}

function setView(mode){
  if(mode === viewMode) return;
  viewMode = mode;
  el.viewTableBtn && el.viewTableBtn.classList.toggle('active', mode==='table');
  el.viewCardsBtn && el.viewCardsBtn.classList.toggle('active', mode==='cards');
  if (el.table) el.table.style.display = mode==='table' ? '' : 'none';
  if (el.cards) el.cards.style.display = mode==='cards' ? '' : 'none';
}

/* =========================================
   DATE RANGE HELPERS
   ========================================= */
function cutoffFromValue(val){
  if(val === 'all') return null;
  const days = parseInt(val, 10);
  const d = new Date();
  d.setHours(0,0,0,0);
  d.setDate(d.getDate() - days);
  return d;
}
function parseRowDate(row){
  const d = new Date(row.published);
  return isNaN(d.getTime()) ? null : d;
}

/* =========================================
   FILTER + SORT + RENDER
   ========================================= */
function applyFilters(){
  const q = (el.search?.value || '').trim().toLowerCase();
  const cat = el.cat?.value || 'all';
  const stat = el.stat?.value || 'all';
  const cutoff = cutoffFromValue(el.range?.value || 'all');
  const sort = el.sort?.value || 'published-desc';

  let filtered = rows.slice();

  if(q){
    filtered = filtered.filter(r =>
      (r.title||'').toLowerCase().includes(q) ||
      (r.keyword||'').toLowerCase().includes(q) ||
      (r.category||'').toLowerCase().includes(q) ||
      (r.status||'').toLowerCase().includes(q)
    );
  }
  if(cat !== 'all') filtered = filtered.filter(r => r.category === cat);
  if(stat !== 'all') filtered = filtered.filter(r => r.status === stat);
  if(cutoff){
    filtered = filtered.filter(r => {
      const d = parseRowDate(r);
      return d && d >= cutoff;
    });
  }

  filtered.sort((a,b) => {
    switch (sort){
      case 'published-asc': return cmpDate(a,b);
      case 'published-desc': return cmpDate(b,a);
      case 'score-asc': return (a.score||0) - (b.score||0);
      case 'score-desc': return (b.score||0) - (a.score||0);
      default: return cmpDate(b,a);
    }
  });

  if(viewMode === 'table') renderTable(filtered); else renderCards(filtered);
}

function cmpDate(a,b){
  const da = parseRowDate(a), db = parseRowDate(b);
  if(!da && !db) return 0;
  if(!da) return -1;
  if(!db) return 1;
  return da - db;
}

function renderTable(data){
  el.tbody.innerHTML = data.map(row => {
    const date = safeDateStr(row.published);
    return `
      <tr>
        <td><span class="muted">${escapeHtml(date)}</span></td>
        <td>${escapeHtml(row.title || '')}</td>
        <td><span class="chip">${escapeHtml(row.category || '')}</span></td>
        <td>${escapeHtml(row.keyword || '')}</td>
        <td>${Number(row.score || 0).toFixed(1)}</td>
        <td><span class="badge">${escapeHtml(row.status || '')}</span></td>
      </tr>
    `;
  }).join('');
}

function renderCards(data){
  el.cards.innerHTML = data.map(row => {
    const date = safeDateStr(row.published);
    return `
      <article class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <span class="chip">${escapeHtml(row.category || '')}</span>
          <span class="badge">${escapeHtml(row.status || '')}</span>
        </div>
        <h3>${escapeHtml(row.title || '')}</h3>
        <p class="muted">${escapeHtml(row.keyword || '')}</p>
        <p class="muted" style="font-size:12px;margin-top:6px">${escapeHtml(date)} • Score ${Number(row.score||0).toFixed(1)}</p>
      </article>
    `;
  }).join('');
}

/* =========================================
   UTILS
   ========================================= */
function safeDateStr(v){
  const d = new Date(v);
  if(isNaN(d)) return v || '';
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function escapeHtml(s){
  return String(s ?? '').replace(/[&<>"']/g, m => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[m]));
}
function debounce(fn, delay=150){
  let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay); };
}
</script>
</body>
</html>
