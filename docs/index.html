<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Signals — List</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg:#ffffff; --fg:#141414; --muted:#6b7280;
    --card:#ffffff; --border:#e5e7eb; --pill:#f3f4f6; --accent:#111827;
    --shadow:0 8px 24px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);
       font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  a{color:#2563eb;text-decoration:none}
  .bar{position:sticky;top:0;z-index:20;backdrop-filter:saturate(180%) blur(10px);
    background:color-mix(in oklab, var(--bg) 92%, transparent); border-bottom:1px solid var(--border)}
  .bar-inner{max-width:1100px;margin:0 auto;padding:12px 20px;
    display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .title{font-weight:700}
  .btn, .select, .input{
    background:var(--card); color:var(--fg); border:1px solid var(--border);
    border-radius:10px; padding:10px 12px; box-shadow:var(--shadow);
  }
  .btn.primary{background:#111827;color:#fff;border-color:#111827}
  .select{min-width:140px}
  .spacer{flex:1}
  .wrap{max-width:1100px;margin:0 auto;padding:16px 20px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:10px 0}
  .small{font-size:12px;color:var(--muted)}
  .pill{padding:4px 8px;font-size:11px;line-height:1;border:1px solid var(--border);
        border-radius:999px;background:var(--pill);}
  .grid{display:grid;gap:14px}
  @media(min-width:900px){ .grid.cards{grid-template-columns:1fr 1fr} }
  .card{background:var(--card);border:1px solid var(--border);
        border-radius:14px;box-shadow:var(--shadow);padding:14px}
  .muted{color:var(--muted)}

  /* Table view */
  .table-wrap{overflow-x:auto;border:1px solid var(--border);border-radius:14px;
              box-shadow:var(--shadow);background:var(--card)}
  table{border-collapse:collapse;min-width:900px;width:100%}
  th, td{padding:10px;border-bottom:1px dashed var(--border);vertical-align:top;text-align:left}
  th{font-weight:600;background:#fafafa;position:sticky;top:0;z-index:5}
  tr:last-child td{border-bottom:none}
</style>

<div class="bar">
  <div class="bar-inner">
    <div class="title">Signals — List</div>

    <select id="cat" class="select">
      <option value="">All categories</option>
      <option>fashion</option><option>beauty</option><option>wellness</option>
    </select>
    <select id="stat" class="select">
      <option value="">All status</option>
      <option>emerging</option><option>bubbling</option><option>mainstream</option>
    </select>
    <input id="from" type="date" class="input" />
    <input id="to" type="date" class="input" />
    <select id="quick" class="select">
      <option value="">All time</option>
      <option value="30">Last 30 days</option>
      <option value="90">Last 90 days</option>
      <option value="180">Last 180 days</option>
    </select>

    <label class="small">Search
      <input id="q" type="search" class="input" placeholder="title / keyword / source" style="min-width:200px">
    </label>

    <select id="view" class="select">
      <option value="cards">Cards view</option>
      <option value="table">Table view</option>
    </select>

    <button id="clear" class="btn">Clear</button>
    <div class="spacer"></div>
    <a class="btn" href="./tags.html">Graphs & Insights →</a>
  </div>
</div>

<div class="wrap">
  <div class="row">
    <span id="metaCount" class="pill">…</span>
  </div>

  <div id="cards" class="grid cards"></div>

  <div id="tableWrap" class="table-wrap" style="display:none">
    <table>
      <thead>
        <tr>
          <th>Published</th>
          <th>Title</th>
          <th>Keyword</th>
          <th>Status</th>
          <th>Category</th>
          <th>Trend score</th>
          <th>Source</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
/* --- Keyword normalization --- */
const KW_MAP = new Map([
  ['anti aging','longevity'], ['anti-ageing','longevity'],
  ['lip-oil','lip oil'], ['lip oils','lip oil'],
  ['old money','quiet luxury'], ['stealth wealth','quiet luxury'],
  ['westernwear','western'], ['cowboy core','western'],
  ['gen ai','ai'], ['gen-ai','ai'], ['generative ai','ai']
]);
function normalizeKw(raw){
  if(!raw) return '';
  let s=String(raw).toLowerCase().trim();
  if(KW_MAP.has(s)) s=KW_MAP.get(s);
  return s;
}
function hostOf(u){try{return new URL(u).host.replace(/^www\./,'');}catch{return '';}}

let rowsAll=[];
function getFiltered(){
  const c=byId('cat').value, s=byId('stat').value, f=byId('from').value, t=byId('to').value;
  const q=byId('q').value.trim();
  let rows=rowsAll.filter(r=>{
    if(c && r.category!==c) return false;
    if(s && (r.status||'').toLowerCase()!==s) return false;
    if(f && r.published<f) return false;
    if(t && r.published>t) return false;
    return true;
  });
  if(q){
    const re=new RegExp(q,'i');
    rows=rows.filter(r=>{
      return re.test(r.title||'') || re.test(normalizeKw(r.primary_keyword||'')) || re.test(hostOf(r.link||''));
    });
  }
  return rows;
}

function render(){
  const rows=getFiltered();
  byId('metaCount').textContent=`${rows.length} articles`;
  const isTable=byId('view').value==='table';
  byId('cards').style.display=isTable?'none':'grid';
  byId('tableWrap').style.display=isTable?'':'block';
  if(isTable) renderTable(rows); else renderCards(rows);
}
function renderCards(rows){
  byId('cards').innerHTML=rows.map(r=>{
    const d=(r.published||'').slice(0,10);
    const host=hostOf(r.link);
    const kw=normalizeKw(r.primary_keyword||'')||'—';
    return `<article class="card">
      <div class="small muted">${d||'—'} · ${host||'—'}</div>
      <h3 style="margin:6px 0"><a href="${r.link}" target="_blank">${r.title||'(untitled)'}</a></h3>
      <div class="row">
        <span class="pill">${kw}</span>
        <span class="pill">${(r.status||'').toLowerCase()||'status?'}</span>
        <span class="pill">${r.category||'—'}</span>
        <span class="pill">score: ${r.trend_score||'—'}</span>
      </div>
    </article>`;
  }).join('')||`<div class="muted">No results.</div>`;
}
function renderTable(rows){
  byId('tbody').innerHTML=rows.map(r=>{
    const d=(r.published||'').slice(0,10);
    const host=hostOf(r.link);
    const kw=normalizeKw(r.primary_keyword||'')||'—';
    return `<tr>
      <td>${d||'—'}</td>
      <td><a href="${r.link}" target="_blank">${r.title||'(untitled)'}</a></td>
      <td>${kw}</td>
      <td>${(r.status||'').toLowerCase()}</td>
      <td>${r.category||''}</td>
      <td>${r.trend_score||''}</td>
      <td>${host||''}</td>
    </tr>`;
  }).join('')||`<tr><td colspan="7" class="muted">No results.</td></tr>`;
}

function byId(id){return document.getElementById(id);}
['cat','stat','from','to','view','q'].forEach(id=>byId(id).addEventListener('input',render));
byId('clear').onclick=()=>{['cat','stat','from','to','q'].forEach(id=>byId(id).value='');render();};

function load(){
  fetch('signals_simple.csv?ts='+new Date().toISOString().slice(0,10))
    .then(r=>r.text())
    .then(csv=>Papa.parse(csv,{header:true,skipEmptyLines:true}))
    .then(res=>{rowsAll=res.data; render();});
}
load();
</script>
